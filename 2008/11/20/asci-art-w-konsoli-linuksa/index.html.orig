<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl">
  <head>
    <title>ASCI art w konsoli linuksa - Radarek bloguje... o Ruby</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="verify-v1" content="XvR5kxyBmJGgUb1Tca8kJ+ii1Vde81UrpDJptt6JMeU=" />
    <link rel="shortcut icon" href="/files/favicon.png" type="image/png" />
    <meta name="keywords" content="256, art, ascii, colors, rmagick, ruby, Programowanie, Ruby, Techblog, Tips &amp; tricks, , ruby, ruby on rails, rails, merb, jruby, yarv, rubinius, ironruby, maglev, programowanie, radarek, radosław bułat, radoslaw bulat, radoslaw, bulat, python, gamedev" />
    <meta name="description" content="Wszystko co wiem o programowaniu, przede wszystkim Ruby." />
    <meta name="robots" content="index,follow"/>

    <link rel="stylesheet" href="/files/style.css" type="text/css" />
    <!--[if lte IE 6]><link rel="stylesheet" href="/files/style-ie6.css" type="text/css" /><![endif]-->
    <!--[if IE 7]><link rel="stylesheet" type="text/css" href="/files/style-ie7.css" /><![endif]-->

    <!--<script type="text/javascript" src="/files/jquery.js"></script>-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="/files/common.js"></script>
    <script type="text/javascript" src="/files/highlight.js"></script>
    <script type="text/javascript" src="/files/dynamic.js"></script>
    <script type="text/javascript" src="/files/jruby.js"></script>
		
    
    <script type="text/javascript">
      hljs.initHighlightingOnLoad('ruby');
    </script>
    
    <!--[if lt IE 7.]><script defer type="text/javascript" src="/files/pngfix.js"></script><![endif]-->

    <link rel="alternate" type="application/atom+xml" title="Radarek bloguje... o Ruby - wpisy" href="http://feeds.feedburner.com/radarek-blog" />
    <link rel="alternate" type="application/atom+xml" title="Radarek bloguje... o Ruby - nagłówki" href="http://feeds.feedburner.com/radarek-blog/headers" />
    <link rel="alternate" type="application/atom+xml" title="Radarek bloguje... o Ruby - miniblog" href="http://feeds.feedburner.com/radarek-blog/miniblog" />
  </head>

  <body>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-837628-3']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
      })();
    </script>
  
    <div id="top">
      <a href="/" id="return-to-main">&nbsp;</a>
      <h3 id="sentence">
        <q>Any fool can make things bigger, more complex, and more violent. It takes a touch of genius and a lot of courage to move in the opposite direction.</q>
        Albert Einstein
      </h3>

      <div id="title-image">
        <div id="ruby-logo"></div>
        <h1>o Ruby</h1>
      </div><!-- title-image -->

      <div id="navigation-tabs">
        <ul id="tabs">
          <li class="active"><a href="/"><span>Wpisy</span></a></li>
          <li><a href="http://radarek.jogger.pl/2007/04/29/o-blogu/"><span>O blogu</span></a></li>
          <li><a href="http://radarek.jogger.pl/2007/05/01/kanaly-rss/"><span>RSS</span></a></li>
          <li><a href="http://radarek.jogger.pl/2007/05/01/kontakt/"><span>Kontakt</span></a></li>
        </ul><!-- tabs -->
      </div><!-- navigations-tabs -->
    </div><!-- top -->

    <div id="top-shadow"></div>

    <div id="content-wrapper">

      <div id="menu">       
        <div class="submenu">
          <form action="/szukaj/" method="post" id="search">
            <fieldset>
              <h3>Szukaj</h3>

              <input class="text" type="text" value="" name="search" /><input class="submit" type="submit" value="Szukaj" />
            </fieldset>
          </form>
        </div>

        <div class="submenu">
          <h3>Subskrypcje RSS</h3>
          <a href="http://feeds.feedburner.com/radarek-blog"><img src="http://feeds.feedburner.com/~fc/radarek-blog?bg=000000&amp;fg=FFFFFF&amp;anim=0" height="26" width="88" style="border: 0; vertical-align: middle; margin: 0;" alt="" /></a> (pełne wpisy)
          <br />
          <span style="position: relative; left: 2em;">+</span>
          <br />
          <a href="http://feeds.feedburner.com/radarek-blog/headers"><img src="http://feeds.feedburner.com/~fc/radarek-blog/headers?bg=000000&amp;fg=FFFFFF&amp;anim=0" height="26" width="88" style="border: 0; vertical-align: middle; margin: 0;" alt="" /></a> (nagłówki)
        </div>

        <div class="submenu">
          <object width="200" height="300" type="application/x-shockwave-flash" data="http://www.blip.pl/widget.swf">
            <param name="movie" value="http://www.blip.pl/widget.swf" />
            <param name="quality" value="high"/>
            <param name="wmode" value="transparent" />
            <param name="flashvars" value="blip_user=radarek&amp;color_scheme=dark&amp;corner_radius=0&amp;"/>
          </object>
        </div>


        <div class="submenu">
          <h3>Miniblog</h3>
          
          <div class="miniblog-post">
            <h4><a class="title" href="http://radarek.jogger.pl/2009/01/01/gist-odpicowane-pastie/">Gist - odpicowane pastie</a></h4>
            01 Sty 2009
            <div class="">
              <p>
  <a href="http://gist.github.com">Gist</a> istnieje już jakiś czas, dopiero teraz przyglądnąłem się mu bliżej. Początkowo wydawało mi się, że to kolejny klon <a href="http://pastie.org">pastie</a>, ale szybko okazało się, że to coś więcej.
</p>

<p>
  Coś więcej ponieważ Gist, prócz tego co potrafi Pastie (edycja pliku online, kolorowanie składni, prywatne pliki), dodaje to co potrafi najlepiej - obsługa repozytoriów <a href="http://git-scm.com/">Git</a>. Otóż każde nowe "pastie" powoduje założenie repozytorium gita, które następnie możemy pobrać (clone), a także wysyłać do niego zmiany (push). Oczywiście nie jesteśmy ograniczeni do 1 pliku, możemy mieć ich tyle ile chcemy. Na stronie pokazywana jest historia rewizji. Dbałość o szczegóły jest firmowym znakiem serwisu <a href="http://github.com">GitHub</a>. Żegnaj Pastie, niech żyje Gist!
</p>

              
            </div><!-- post-body -->
          </div>
          
          <div class="miniblog-post">
            <h4><a class="title" href="http://radarek.jogger.pl/2008/10/12/mp3-przeboje/">Mp3 Przeboje</a></h4>
            12 Paź 2008
            <div class="">
              <a href="http://mp3przeboje.pl">http://mp3przeboje.pl/</a> to serwis dzięki, któremu możesz odsłuchać aktualne najciekawsze utwory muzyczne prosto z przeglądarki. Po prosty wybierz interesującą Cię listę przebojów (aktualnie 22 listy z różnych stacji radiowych) i słuchaj. Programiście projektu <a href="http://md6.org/">oki</a>emu należą się słowa uznania za staranność wykonania (serwis w zasadzie dopiero wystartował i ciągle się rozwija).
              
            </div><!-- post-body -->
          </div>
          
        </div>

        <div class="submenu">
          <h3>Narzędzia</h3>

          <ul id="tools">
            <li><a href="javascript:irb_console.toggle();">JRuby irb console</a></li>
          </ul>
        </div>

        <div class="submenu">
          <h3>Kategorie</h3>

          <ul id="categories">
          
            <li id="blog"><a href="http://radarek.jogger.pl/kategoria/blog/">Blog (6)</a></li>
          
            <li id="c"><a href="http://radarek.jogger.pl/kategoria/c/">C (1)</a></li>
          
            <li id="gamedev"><a href="http://radarek.jogger.pl/kategoria/gamedev/">Gamedev (1)</a></li>
          
            <li id="git"><a href="http://radarek.jogger.pl/kategoria/git/">Git (2)</a></li>
          
            <li id="humor"><a href="http://radarek.jogger.pl/kategoria/humor/">Humor (3)</a></li>
          
            <li id="java"><a href="http://radarek.jogger.pl/kategoria/java/">Java (1)</a></li>
          
            <li id="jruby"><a href="http://radarek.jogger.pl/kategoria/jruby/">JRuby (2)</a></li>
          
            <li id="miniblog"><a href="http://radarek.jogger.pl/kategoria/miniblog/">Miniblog (8)</a></li>
          
            <li id="narzedzia"><a href="http://radarek.jogger.pl/kategoria/narzedzia/">Narzędzia (7)</a></li>
          
            <li id="programowanie"><a href="http://radarek.jogger.pl/kategoria/programowanie/">Programowanie (7)</a></li>
          
            <li id="python"><a href="http://radarek.jogger.pl/kategoria/python/">Python (4)</a></li>
          
            <li id="ruby"><a href="http://radarek.jogger.pl/kategoria/ruby/">Ruby (37)</a></li>
          
            <li id="ruby_merb"><a href="http://radarek.jogger.pl/kategoria/ruby/merb/">Merb (2)</a></li>
          
            <li id="ruby_ruby-on-rails"><a href="http://radarek.jogger.pl/kategoria/ruby/ruby-on-rails/">Ruby on Rails (6)</a></li>
          
            <li id="techblog"><a href="http://radarek.jogger.pl/kategoria/techblog/">Techblog (36)</a></li>
          
            <li id="tips-tricks"><a href="http://radarek.jogger.pl/kategoria/tips-tricks/">Tips &amp; tricks (9)</a></li>
          
            <li id="web"><a href="http://radarek.jogger.pl/kategoria/web/">Web (2)</a></li>
          
          </ul>
        </div>

        <div class="submenu">
          <h3>Tagi</h3>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/blog/">Blog</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/c/">C</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/gamedev/">Gamedev</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/git/">Git</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/humor/">Humor</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/java/">Java</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/jruby/">JRuby</a>
          
            <a class="catlvl1" href="http://radarek.jogger.pl/kategoria/miniblog/">Miniblog</a>
          
            <a class="catlvl1" href="http://radarek.jogger.pl/kategoria/narzedzia/">Narzędzia</a>
          
            <a class="catlvl1" href="http://radarek.jogger.pl/kategoria/programowanie/">Programowanie</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/python/">Python</a>
          
            <a class="catlvl3" href="http://radarek.jogger.pl/kategoria/ruby/">Ruby</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/ruby/merb/">Merb</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/ruby/ruby-on-rails/">Ruby on Rails</a>
          
            <a class="catlvl3" href="http://radarek.jogger.pl/kategoria/techblog/">Techblog</a>
          
            <a class="catlvl1" href="http://radarek.jogger.pl/kategoria/tips-tricks/">Tips &amp; tricks</a>
          
            <a class="catlvl0" href="http://radarek.jogger.pl/kategoria/web/">Web</a>
          
        </div>

        <div class="submenu">
          <h3>Linki</h3>
          <ul id="links">
            <li><a href="http://mp3przeboje.pl/">mp3 przeboje</a></li>
            <li><a href="http://linuxlinki.md6.org/">Linux linki</a></li>
          </ul>
        </div>

        <div class="submenu">
          <h3>Archiwum</h3>
          <ul id="archives">
            
              <li><a href="/startid/470765">21.02.09-19.04.10
 (5)</a></li>
            
              <li><a href="/startid/433510">08.12.08-12.02.09
 (5)</a></li>
            
              <li><a href="/startid/425293">21.11.08-06.12.08
 (5)</a></li>
            
              <li><a href="/startid/423490">27.05.08-20.11.08
 (5)</a></li>
            
              <li><a href="/startid/392066">12.03.08-21.04.08
 (5)</a></li>
            
              <li><a href="/startid/383421">25.11.07-01.03.08
 (5)</a></li>
            
              <li><a href="/startid/364188">12.10.07-20.11.07
 (5)</a></li>
            
              <li><a href="/startid/337815">29.05.07-20.07.07
 (5)</a></li>
            
              <li><a href="/startid/323920">05.05.07-28.05.07
 (5)</a></li>
            
          </ul>
        </div>

      </div><!-- menu -->

      <div id="content">
        <div class="translation-info" style="display: none;">
          <script type="text/javascript" src="http://www.gmodules.com/ig/ifr?url=http://www.google.com/ig/modules/translatemypage.xml&amp;up_source_language=pl&amp;w=160&amp;h=60&amp;title=&amp;border=&amp;output=js"></script>
          <h4>Looking for english version of this blog?</h4>
          <p>
          Hello Stranger! This page is written in polish language and it looks like your is different than that.
          Currently I cannot afford english version of this page. The easiest way to (at least try) read this page on another language is to use automatic Google Translator. Thanks for visit!
          </p>
          <div style="clear: left;"></div>
        </div>

        <div style="margin-bottom: 1em;">
          <script type="text/javascript" id="AdTaily_Widget" src="http://static.adtaily.pl/widget.js#foobarbaz"></script>
          <noscript><p><a href="http://www.adtaily.pl">Skuteczna reklama na blogach sprzedawana za pomocą AdTaily</a>(PLALLADTAILY0002)</p></noscript>
        </div>

        <div class="post">

          <div class="post-header">
            <div class="post-date">
              <small>2008</small>
              <span>20</span>
              <small>Lis</small>
            </div><!-- post-date -->
            <h2 class="post-title"><a class="title" href="http://radarek.jogger.pl/2008/11/20/asci-art-w-konsoli-linuksa/">ASCI art w konsoli linuksa</a></h2>
            
            <a href="http://radarek.jogger.pl/2008/11/20/asci-art-w-konsoli-linuksa/#comments">10 komentarzy</a>
            | Kategorie:
            
              <a class="strong" href="http://radarek.jogger.pl/kategoria/programowanie/">Programowanie,</a>
            
              <a class="strong" href="http://radarek.jogger.pl/kategoria/ruby/">Ruby,</a>
            
              <a class="strong" href="http://radarek.jogger.pl/kategoria/techblog/">Techblog,</a>
            
              <a class="strong" href="http://radarek.jogger.pl/kategoria/tips-tricks/">Tips &amp; tricks</a>
            
            
              | <a href="http://radarek.jogger.pl/2008/11/20/asci-art-w-konsoli-linuksa/trackback/">trackback</a>
            
            

            
            <br />
              Tagi:
                
                  <a class="strong" href="http://technorati.com/tags/256" rel="tag">
                  256</a>
                
                  <a class="strong" href="http://technorati.com/tags/art" rel="tag">
                  art</a>
                
                  <a class="strong" href="http://technorati.com/tags/ascii" rel="tag">
                  ascii</a>
                
                  <a class="strong" href="http://technorati.com/tags/colors" rel="tag">
                  colors</a>
                
                  <a class="strong" href="http://technorati.com/tags/rmagick" rel="tag">
                  rmagick</a>
                
                  <a class="strong" href="http://technorati.com/tags/ruby" rel="tag">
                  ruby</a>
                
            
          </div><!-- post-header -->

          <div class="post-body">
            
<p>
Jako programista spędzam spędzam sporo czasu pracując z konsolą. Konsola ma to do siebie, że wyświetla głównie... znaki. Wydawać by się mogło, że brak możliwości wyświetlania grafiki nie pozwala na urozmaicenie tego co jest w niej wyświetlane. Na szczęście tak nie jest. Mamy przecież ASCII art!
<a href="http://en.wikipedia.org/wiki/ASCII_art">ASCII art</a> to sztuka tworzenia obrazków złożonych ze znaków <a href="http://en.wikipedia.org/wiki/ASCII">ASCII</a>.
</p>



<p>
Chociaż ASCII art głównie polega na (jak mi się wydaje) mozolnym układaniu obrazka z różnych znaków, to mnie zainteresowała kwestia <a href="http://en.wikipedia.org/wiki/ASCII_art#Image_to_text_conversion">konwersji obrazka do postaci tekstowej</a>.
</p>

<p>
Okazuje się, że do uzyskania całkiem zadowalających efektów nie trzeba bardzo skomplikonwago algorytmu. Najprostsze podejście to wejściowy obrazek pomniejszyć do docelowego rozmiaru w znakach. Następnie każdy pojedynczy pixel będzie odpowiadać jednemu wyświetlonymu znakowi. Pozostaje jeszcze kwestia koloru.
</p>

<p>
Większość terminali linuksowych pozwala na wyświetlanie 16 kolorów, za pomocą tzw. sekwencji unikowych (escape sequences). Okazuje się jednak, że nowsze wersje, np. używany przeze mnie gnome-terminal, potrafi wyświetlać nawet 256 kolorów. Z taką ilością kolorów można uzyskać dosyć ciekawe efekty.
</p>

<p>
Jeśli chciałbyś sprawdzić czy Twój terminal potrafi wyświetlać 256 kolorów to możesz skorzystać ze strony: <a href="http://www.frexx.de/xterm-256-notes/">http://www.frexx.de/xterm-256-notes/</a>. Pobierz perlowy skrypt <a href="http://www.frexx.de/xterm-256-notes/data/256colors2.pl">256colors2.pl</a>, który próbuje wyświetlić wszystkie kolory.
</p>

<p>
Na tej stronie znalazłem także <a href="http://www.frexx.de/xterm-256-notes/data/xterm256-conv2.tar.bz2">program w języku C</a>, który dla zadanego koloru w postaci (r,g,b) szuka najbardziej pasującego koloru z palety 256 "terminalowych" kolorów. Jest to bardzo pomocne, jeśli chcemy wyświetlać nasze ASCII arty (a taki był mój cel) w konsoli.
</p>

<h3>Piszemy w Rubym</h3>
<p>
Pierwszym krokiem było przepisanie kodu odpowiedzialnego za konwertowanie kolorów.
</p>

<pre><code class="ruby">module Xterm256Color
  # the 6 value iterations in the xterm color cube
  VALUERANGE = [
    0x00, 0x5F, 0x87, 0xAF, 0xD7, 0xFF
  ]

  # 16 basic colors
  BASIC16 = [
    [ 0x00, 0x00, 0x00 ], # 0
    [ 0xCD, 0x00, 0x00 ], # 1
    [ 0x00, 0xCD, 0x00 ], # 2
    [ 0xCD, 0xCD, 0x00 ], # 3
    [ 0x00, 0x00, 0xEE ], # 4
    [ 0xCD, 0x00, 0xCD ], # 5
    [ 0x00, 0xCD, 0xCD ], # 6
    [ 0xE5, 0xE5, 0xE5 ], # 7
    [ 0x7F, 0x7F, 0x7F ], # 8
    [ 0xFF, 0x00, 0x00 ], # 9
    [ 0x00, 0xFF, 0x00 ], # 10
    [ 0xFF, 0xFF, 0x00 ], # 11
    [ 0x5C, 0x5C, 0xFF ], # 12
    [ 0xFF, 0x00, 0xFF ], # 13
    [ 0x00, 0xFF, 0xFF ], # 14
    [ 0xFF, 0xFF, 0xFF ]  # 15
  ]

  # convert an xterm color value (0-253) to three elements array [r, g, b]
  def self.xterm2rgb(color)
    case color
    when 0..15
      return BASIC16[color].dup

    when 16..232
      color -= 16
      return [VALUERANGE[(color / 36) % 6], VALUERANGE[(color / 6) % 6], VALUERANGE[color % 6]]

    when 233..253
      return [8 + (color - 232) * 0x0a] * 3

    else
      raise ArgumentError, &quot;expected color value in range 0..253 but was #{color}&quot;
    end
  end

  # fill the colortable for use with rgb2xterm
  def self.make_table
    @colortable ||=
      begin
        colortable = []
        0.upto(253) do |color|
          rgb = xterm2rgb(color)
          colortable &lt;&lt; rgb
        end
        colortable
      end
  end

  # selects the nearest xterm color for a given [r, g, b] color table
  def self.rgb2xterm(rgb)
    @rgb2xterm_cache ||= {}
    return @rgb2xterm_cache[rgb] ||=
      begin
        self.make_table
        smallest_distance = 1_000_000_000_000
        best_match = 0

        0.upto(253) do |color|
          d = self.euclidean_distance(@colortable[color], rgb)
          if d &lt; smallest_distance
            smallest_distance = d
            best_match = color
          end
        end
        best_match
      end
  end

  # Return euclidean distance between two given vectors v1 and v2.
  # Example:
  #   Xterm256Color.euclidean_distance([0, 0], [1, 1]) # =&gt; 1.4142...
  def self.euclidean_distance(v1, v2)
    raise ArgumentError, &quot;Expected two arrays&quot; unless v1.is_a?(Array) &amp;&amp; v2.is_a?(Array)
    raise ArgumentError, &quot;Expected two array with the same size (#{v1.size} &lt;=&gt; #{v2.size})&quot; if v1.size != v2.size

    #sum_of_squares = v1.zip(v2).inject(0) {|acc, (a, b)| acc + (a - b) ** 2 }
    sum_of_squares = 0
    v1.size.times do |i|
      sum_of_squares += (v1[i] - v2[i]) * (v1[i] - v2[i])
    end

    return Math.sqrt(sum_of_squares)
  end
end

</code></pre>

<p>
Nie wdając się w szczegóły nas interesuje metoda Xterm256Color.rgb2xterm(rgb), która dla 3 elementowej tablicy [r,g,b] zwraca liczbę z przedziału 0..253 (szczerze mówiąc nie wiem czemu nie 255).
</p>

<h3>Mała poprawka w algorytmie</h3>
<p>
W zasadzie z dotychczasowych elementów moglibyśmy już napisać działający program. Chciałem jednak zwrócić uwagę na jeszcze jedną kwestię. Mianowicie jaki znak powinien być wyświetlany jako piksel? W najprostszym przypadku można wyświetlać zawsze ten sam znak (np. "0", "#") lub z zadanego zbioru naprzemiennie (np. dla "01" będzie 010101...). Takie podejście możemy zaobserwować korzystając z konwertera online na stronie <a href="http://www.text-image.com/convert/">http://www.text-image.com/convert/</a>.
</p>

<p>
Okazuje się, że wystarczy mała poprawka by uzyskać lepszy efekt. Należy zdefiniować ciąg znaków (który nazwiemy gradientem). Następnie w zależności od intensywności danego koloru zostanie wybrany odpowiadający mu (proporcjonalnie) znak. Chodzi o to, żeby kolory, które odbieramy jako mało intensywne reprezentować poprzez mało rzucające sie w oczy znaki. Np. intensywny czerwony kolor (rgb=[255, 0, 0]) wyświetlimy poprzez znak "@", zaś szary kolor poprzez ":". Dzieki temu obrazek powinien uzyskać większej glębi niż przy wyświetlaniu go za pomocą jednego znaku.
</p>

<h3>Pora na kodowanie</h3>
<p>
Poniżej umieszczam implementację klasy AsciiArt służącej do konwersji obrazka na ASCII art.
</p>

<pre><code class="ruby">require &quot;xterm256color&quot;
require &quot;RMagick&quot;
require &quot;open-uri&quot;

class AsciiArt
  class Error &lt; StandardError; end
  DEFAULT_GRADIENT = &quot;.:coCO8@&quot;

  attr_accessor :characters_array, :colored

  def initialize(colored)
    @colored = colored
    @characters_array = []
  end

  def colored?
    return @colored
  end

  # Create AsciiArt instance from given image file.
  # Parameters:
  #  image_file_path can be regular path to file or http URL
  #  width - width in characters of created ascii art
  #  gradient - nil or string with gradient characters
  # Example:
  #   ascii_art = AsciiArt.from_image_file(&quot;images/image.jpg&quot;)
  #   ascii_art.print
  def self.from_image_file(image_file_path, width, colored = true, gradient = nil)
    gradient = DEFAULT_GRADIENT if gradient.nil?
    image = Magick::Image.read(image_file_path).first

    image.change_geometry(&quot;#{width}x&quot;) do |w, h, img|
      img.resize!(w, h / 2.2, Magick::BoxFilter)
    end
    image = image.sharpen(1.0)
    image = image.contrast(true)

    characters_array = []
    0.upto(image.rows - 1) do |row|
      characters_array &lt;&lt; []
      0.upto(image.columns - 1) do |column|
        pixel = image.pixel_color(column, row)
        rgb = [pixel.red, pixel.green, pixel.blue]
        rgb.map! {|value| value &gt;&gt; (Magick::QuantumDepth - 8) }

        char = gradient[pixel.intensity * gradient.size / (Magick::QuantumRange + 1), 1]
        characters_array.last &lt;&lt; [char, rgb]
      end
    end

    ascii_art = AsciiArt.new(colored)
    ascii_art.characters_array = characters_array

    return ascii_art
  rescue Magick::ImageMagickError =&gt; e
    raise Error.new(&quot;Could not read file #{image_file_path} (#{e.message})&quot;)
  end

  def to_html
    html = &quot;&quot;
    html &lt;&lt; &quot;&lt;pre style=\&quot;background-color: black; font-size: 8px;\&quot;&gt;&quot;
    self.characters_array.each do |row|
      row.each do |char, rgb|
        if self.colored?
          html &lt;&lt; sprintf(&quot;&lt;span style=\&quot;color: rgb(%d, %d, %d)\;\&quot;&gt;%s&lt;/span&gt;&quot;, rgb[0], rgb[1], rgb[2], char)
        else
          html &lt;&lt; char
        end
      end
      html &lt;&lt; &quot;\n&quot;
    end
    html &lt;&lt; &quot;&lt;/pre&gt;&quot;

    return html
  end

  def to_text
    text = &quot;&quot;
    self.characters_array.each do |row|
      row.each do |char, rgb|
        if self.colored?
          color = Xterm256Color.rgb2xterm(rgb)
          text &lt;&lt; sprintf(&quot;\033[38;5;%dm%s\e[0m&quot;, color, char)
        else
          text &lt;&lt; char
        end
      end
      text &lt;&lt; &quot;\n&quot;
    end

    return text
  end
end

</code></pre>

<p>
Teraz wystarczy napisać prosty skrypt korzystający z tej klasy i sprawdzić rezultaty.
</p>

<pre><code class="ruby">require &quot;rubygems&quot;
require &quot;ascii_art&quot;

if !ARGV.size.between?(1, 2)
  puts &quot;Usage: ruby image2ascii IMAGE_FILE [COLUMNS=80]&quot;
  puts &quot;Display given IMAGE_FILE (regular file or URL) as colored ascii art.\nCOLUMNS defines number of chars per one line.&quot;
  exit 1
end

file = ARGV.first
width = (ARGV[1] || 80).to_i

ascii_art = AsciiArt.from_image_file(file, width, true)
print ascii_art.to_text

</code></pre>

<h3>Uzyskane rezultaty</h3>
<p>
Poniżej prezentuję uzyskane przeze mnie rezyltaty.
</p>

<a href="http://img179.imageshack.us/img179/686/80835590ux6.png"><img class="single" src="http://img179.imageshack.us/img179/686/80835590ux6.th.png" alt="ruby logo in ascii art format" /></a>

<a href="http://img179.imageshack.us/img179/3296/30557736gm3.png"><img class="single" src="http://img179.imageshack.us/img179/3296/30557736gm3.th.png" alt="new ruby logo in ascii format" /></a>

<a href="http://img153.imageshack.us/img153/4372/88365333uf1.png"><img class="single" src="http://img153.imageshack.us/img153/4372/88365333uf1.th.png" alt="java duke with ruby in ascii format" /></a>

<a href="http://img212.imageshack.us/img212/3628/95828589ux0.png"><img class="single" src="http://img212.imageshack.us/img212/3628/95828589ux0.th.png" alt="linux tux logo in ascii format" /></a>

<a href="http://img404.imageshack.us/img404/5776/80552373pz2.png"><img class="single" src="http://img404.imageshack.us/img404/5776/80552373pz2.th.png" alt="firefox logo in ascii format" /></a>

<p>
Jeśli dobrze się przyjrzysz to zauważysz, że program może dostać jako parametr scieżkę do pliku bądź adres URL. Zatem jeśli tylko chcesz to ściągaj kod i baw się dobrze :).
</p>

<p>
Źródła na pastie.org:<br />
<a href="http://pastie.org/319275">xterm256color.rb</a><br />
<a href="http://pastie.org/319277">ascii_art.rb</a><br />
<a href="http://pastie.org/319278">image2ascii.rb</a><br />
</p>

          </div><!-- post-body -->
        </div><!-- post -->
        <div class="separator"></div>
        
        <div class="wykop" style="padding: 1px;" >
          <p style="margin-top: 10px;">
          Jeśli spodobał Ci się wpis to może umieścisz ten blog w swoim czytniku RSS?
          </p>
        </div>
        <div style="clear: left;"></div>

        

        
        <h3>Komentarze</h3>
        

        <div id="comments">
        
          <div id="comment-1293241" class="comment1 jogger">
            
            1.
            
            <img class="avatar-icon" src="http://pecet.jogger.pl/files/favicon.ico" alt="avatar icon" />
            
            
            <strong><a href="http://pecet.jogger.pl">pecet</a></strong> napisał(a) 20 Lis 2008 o godz. 01:16:
            <div class="top"></div>
            <div class="content">
              <p>Obrazki skonwertowane skryptami nie można nazwać &#8222;Ascii-Artem&#8221; w gwoli jasności.</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293246" class="comment2 jogger">
            
            2.
            
            <img class="avatar-icon" src="http://zal.jogger.pl/files/favicon.png" alt="avatar icon" />
            
            
            <strong><a href="http://zal.jogger.pl">Zal</a></strong> napisał(a) 20 Lis 2008 o godz. 01:49:
            <div class="top"></div>
            <div class="content">
              <p>Artem faktycznie tego nazwać nie można, ale sam program jest świetny! :] Swego czasu korzystałem z wersji online, ale ta będzie lepsza.</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293248" class="comment1 guest">
            
            3.
            
            
            <img class="avatar-icon" src="/files/default-avatar-icon.png" alt="avatar icon" />
            
            <strong>dmilith</strong> napisał(a) 20 Lis 2008 o godz. 02:01:
            <div class="top"></div>
            <div class="content">
              <p>będąc czepialskim osobnikiem dodam, że w zasadzie wystarczy
#!/usr/bin/env ruby<br />
na początku skryptu image2ascii, wtedy możemy go używać bez poprzedzania skryptu poleceniem &#8222;ruby&#8221;.<br />
zadziała w zasadzie pod każdym POSIX&#8217;em</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293288" class="comment2 owner">
            
            4.
            
            <img class="avatar-icon" src="http://radarek.jogger.pl/files/favicon.png" alt="avatar icon" />
            
            
            <strong><a href="http://radarek.jogger.pl">Radarek</a></strong> napisał(a) 20 Lis 2008 o godz. 09:13:
            <div class="top"></div>
            <div class="content">
              <p>@pecet: zapewne masz rację, na swoje usprawiedliwienie powiem, że na wiki (tak jak podlinkowałem we wpisie) jest przykład z tego typu obrazkiem.</p>

<p>@dmilith: &#8222;shebang line&#8221; jest mi znane. Ponieważ ostatnio testuje swoje programy pod różnymi wersjami rubiego to nie zaprzątam sobie głowy takimi szczegółami.</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293307" class="comment1 guest">
            
            5.
            
            
            <img class="avatar-icon" src="/files/default-avatar-icon.png" alt="avatar icon" />
            
            <strong>oki</strong> napisał(a) 20 Lis 2008 o godz. 10:28:
            <div class="top"></div>
            <div class="content">
              <p>A moze push na githuba? :)</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293319" class="comment2 owner">
            
            6.
            
            <img class="avatar-icon" src="http://radarek.jogger.pl/files/favicon.png" alt="avatar icon" />
            
            
            <strong><a href="http://radarek.jogger.pl">Radarek</a></strong> napisał(a) 20 Lis 2008 o godz. 11:00:
            <div class="top"></div>
            <div class="content">
              <p>@oki, chodziła mi taka myśl po głowie i pomyślałem, że to zbyt mały kawałek kodu. W sumie może ktoś chciałby się tym pobawić. Przekonałeś mnie ;-).</p>

<p><a href="http://github.com/Radarek/ascii_art/tree/master">http://github.com/Radarek/ascii_art/tree/master</a></p>

<p>Będę musiał zmienił strukturę (lib/ascii_art.rb itp) i zamknąć wszystkie klasy w module AsciiArt.</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293327" class="comment1 guest">
            
            7.
            
            
            <img class="avatar-icon" src="/files/default-avatar-icon.png" alt="avatar icon" />
            
            <strong>deluge</strong> napisał(a) 20 Lis 2008 o godz. 11:34:
            <div class="top"></div>
            <div class="content">
              <p>To, że konsola to nie znaczy że nie można wyświetlać grafiki &#8211; od czego jest framebffer. Z powodzeniem oglądałem np filmy w mplayerze.</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1293496" class="comment2 guest">
            
            8.
            
            
            <img class="avatar-icon" src="/files/default-avatar-icon.png" alt="avatar icon" />
            
            <strong><a href="http://blog.drogomir.com" rel="nofollow">Drogomir</a></strong> napisał(a) 20 Lis 2008 o godz. 18:29:
            <div class="top"></div>
            <div class="content">
              <p>Wrzuć to jako gema :D</p>

<p>Genialnie to wygląda w sumie :D</p>

<p>Wiem, że podniecam się jak dziecko, ale pierwszy raz widzę takie efekty w konsoli ;-)</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1294068" class="comment1 owner">
            
            9.
            
            <img class="avatar-icon" src="http://radarek.jogger.pl/files/favicon.png" alt="avatar icon" />
            
            
            <strong><a href="http://radarek.jogger.pl">Radarek</a></strong> napisał(a) 21 Lis 2008 o godz. 14:29:
            <div class="top"></div>
            <div class="content">
              <p>@Drogomir: tak też zrobię. Widzę, że dodałeś do obserwowanych projektów na githubie więc będziesz pierwszy wiedzieć jak zrobię pusha;-).</p>
            </div>
            <div class="footer"></div>
          </div>
        
          <div id="comment-1592387" class="comment2 guest">
            
            10.
            
            
            <img class="avatar-icon" src="/files/default-avatar-icon.png" alt="avatar icon" />
            
            <strong>JJ</strong> napisał(a) 21 Kwi 2011 o godz. 10:04:
            <div class="top"></div>
            <div class="content">
              <p>Doskonale!</p>

            </div>
            <div class="footer"></div>
          </div>
        
        </div><!-- comments -->

        

        

        

        
        <h3>Musisz się zalogować, jeśli chcesz dodać komentarz.</h3>
        
      </div><!-- content -->

      <div class="cleaner"></div>

    </div><!-- content-wrapper -->

    <div id="footer" style="clear: both;">
    <div id="footer-shadow"></div>
        <h3>Czytelnicy</h3>
        <script type="text/javascript" src="http://pub.mybloglog.com/comm2.php?mblID=2007050116063791&amp;c_width=800&amp;c_sn_opt=n&amp;c_rows=3&amp;c_img_size=f&amp;c_heading_text=&amp;c_color_heading_bg=FFFFFF&amp;c_color_heading=000000&amp;c_color_link_bg=FFFFFF&amp;c_color_link=000000&amp;c_color_bottom_bg=FFFFFF"></script>
      <div id="bottom-para">
        <p>
          &copy; 2007-2010, Radarek bloguje. Graphics, css, xhtml, javascript code by <a href="/">Radarek</a>
          | <a href="http://validator.w3.org/check/referer">Valid XHTML 1.0 Strict</a>
          | <a href="http://jigsaw.w3.org/css-validator/check/referer">Valid CSS</a>
        </p>
      </div>
    </div><!-- footer -->

    <div id="jruby-irb-console" style="display: none;">
      <div class="overlay">
        <div class="window">
          <div class="inner">
            <a class="close-popup" href="#">Zamknij</a>
            <div class="irb-console-applet">
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--</div>-->
  </body>
</html>